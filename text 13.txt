local function enableMobileDesync()
	local success, err = pcall(function()
		local backpack = LocalPlayer:WaitForChild("Backpack")
		local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
		local humanoid = character:WaitForChild("Humanoid")

		local packages = ReplicatedStorage:WaitForChild("Packages", 5)
		if not packages then return end
		local netFolder = packages:WaitForChild("Net", 5)
		if not netFolder then return end
		local useItemRemote = netFolder:WaitForChild("RE/UseItem", 5)
		local teleportRemote = netFolder:WaitForChild("RE/QuantumCloner/OnTeleport", 5)
		if not useItemRemote or not teleportRemote then return end

		local toolNames = {"Quantum Cloner", "Brainrot", "brainrot"}
		local tool
		for _, name in ipairs(toolNames) do
			tool = backpack:FindFirstChild(name) or character:FindFirstChild(name)
			if tool then break end
		end
		if not tool then
			for _, item in ipairs(backpack:GetChildren()) do
				if item:IsA("Tool") then tool=item break end
			end
		end

		if tool and tool.Parent==backpack then
			humanoid:EquipTool(tool)
			task.wait(0.2)
		end

		if setfflag then setfflag("WorldStepMax", "-9999999999") end
		task.wait(0.1)
		useItemRemote:FireServer()
		task.wait(1)
		teleportRemote:FireServer()
		task.wait(2)
		if setfflag then setfflag("WorldStepMax", "-1") end
	end)
	if not success then warn(err) end
end

local function disableMobileDesync()
	pcall(function()
		if setfflag then setfflag("WorldStepMax", "-1") end
	end)
end

--// Toggles
SpeedButton.MouseButton1Click:Connect(function()
	speedActive = not speedActive
	if speedActive then
		startSpeed()
		SpeedButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
	else
		stopSpeed()
		SpeedButton.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
	end
end)

CarpetButton.MouseButton1Click:Connect(function()
	carpetActive = not carpetActive
	if carpetActive then
		startCarpet()
		CarpetButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
	else
		stopCarpet()
		CarpetButton.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
	end
end)

DesyncButton.MouseButton1Click:Connect(function()
	desyncActive = not desyncActive
	if desyncActive then
		enableMobileDesync()
		DesyncButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
	else
		disableMobileDesync()
		DesyncButton.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
	end
end)

--// Spacebar
UserInputService.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == Enum.KeyCode.Space then
		spaceDown = true
	end
end)

UserInputService.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == Enum.KeyCode.Space then
		spaceDown = false
	end
end)
